package Main;

import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.util.ArrayList;
import java.util.Scanner;

public class AdminController {
	private Scanner scan = new Scanner(System.in);
	SocketController socketController;

	public AdminController(SocketController socketController) {
		this.socketController = socketController;
	}

	public void adminMenu() throws ClassNotFoundException {
		loop: while (true) {
			System.out.println("\nEnter options:\n" + "1.Add book\n" + "2.Show all books\n" + "3.Search book\n"
					+ "4.Delete book\n" + "5.Update book\n" + "6.Quit\n");
			int number = scan.nextInt();
			switch (number) {
			case 1:
				addToAllBooks();
				break;
			case 2:
				showAllBooks();
				break;
			case 3:
				searchInAllBooks();
				break;
			case 4:
				deleteBook();
				break;
			case 5:
				updateBook();
				break;
			case 6:
				return;
			default:
				System.out.println("enter 1-4");
				break loop;
			}
		}

	}

	private void updateBook() throws ClassNotFoundException {
		ArrayList<Book> listBooks = getAllBooks();
		printBooksList(listBooks);
		System.out.println("Please enter number of book: ");
		int number;
		number = scan.nextInt();
		Book book;
		book = listBooks.get(number - 1);
			System.out.println("Choose field to update: \n" + "1. Author\n" + "2. Title\n" + "3. Year\n" + "4. Genre\n");
			int field = scan.nextInt();
			String author, title, year, genre;
			switch (field) {
			case 1:
				System.out.println("Enter Author's name and surname: ");
				scan.nextLine();
				author = scan.nextLine();
				book.setAuthor(author);
				break;
			case 2:
				System.out.println("Enter title of the book: ");
				title = scan.next();
				book.setTitle(title);
				break;
			case 3:
				System.out.println("Enter 4 digits of year: ");
				year = scan.next();
				book.setYear(year);
				break;
			case 4:
				System.out.println("Enter genre: ");
				genre = scan.next();
				book.setGenre(genre);
				break;
			default:
				System.out.println("enter 1-4");
				break;
		}
		socketController.writeObject(ServerMessage.UPDATE_BOOK, book);
	}

	private void deleteBook() throws ClassNotFoundException {
		ArrayList<Book> listBooks = getAllBooks();
		printBooksList(listBooks);
		System.out.println("Choose number of book: \n");
		int number = scan.nextInt();
		int bookId = listBooks.get(number - 1).getBookId();
		String bookIdStr = String.valueOf(bookId);
		socketController.write(ServerMessage.DELETE_BOOK, bookId);
	}

	private void printBooksList(ArrayList<Book> listBooks) throws ClassNotFoundException {
		Book book = null;
		if (listBooks != null) {
			for (int i = 0; i < listBooks.size(); i++) {
				book = listBooks.get(i);
				System.out.println((i + 1) + ". " + book);
			}
		}
	}

	private ArrayList<Book> getAllBooks() throws ClassNotFoundException {
		ArrayList<Book> allBooks = null;
		socketController.writeMessage(ServerMessage.GET_ALL_BOOKS);
		allBooks = socketController.read();
		return allBooks;
	}

	private void addToAllBooks() throws ClassNotFoundException {
		System.out.println("Please enter Author:");
		scan.nextLine();
		String author = scan.nextLine();
		System.out.println("Please enter Title:");
		String title = scan.nextLine();
		System.out.println("Please enter Year:");
		String year = scan.nextLine();
		System.out.println("Please enter Genre:");
		String genre = scan.nextLine();
		Book book = new Book(author, title, year, genre);
		socketController.writeObject(ServerMessage.ADD_BOOK, book);
	}

	public void showAllBooks() throws ClassNotFoundException {
		ArrayList<Book> allBooks;
		socketController.write(ServerMessage.GET_ALL_BOOKS);
		allBooks = socketController.read();
		int count = 1;
		for (Book book : (allBooks)) {
			System.out.println(count + ". " + book);
			count++;
		}
	}

	public void searchInAllBooks() throws ClassNotFoundException {
		ArrayList<Book> foundBooks;
		System.out.println("Please enter search text: ");
		String text = scan.next();
		socketController.write(ServerMessage.SEARCH_BOOK, text);
		foundBooks = socketController.read();
		int count = 1;
		for (Book book : foundBooks) {
			System.out.println(count + ". " + book);
			count++;
		}
	}
}
